<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScandiKitchen Master Pro</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root { --milk: #f4f1ea; --olive: #556b2f; --text: #333; --white: #ffffff; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background: var(--milk); color: var(--text); margin: 0; padding-bottom: 60px; }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¢–ó */
        header { background: var(--white); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .nav-buttons { display: flex; gap: 10px; }

        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        /* –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ */
        .filters-block { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        select, input { padding: 12px; border-radius: 15px; border: 1px solid #ddd; font-size: 1rem; width: 100%; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .recipe-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); cursor: pointer; transition: 0.2s; }
        .card:hover { transform: translateY(-5px); }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { padding: 12px 20px; border-radius: 15px; border: none; font-weight: 600; cursor: pointer; transition: 0.2s; text-decoration: none; display: inline-block; text-align: center; }
        .btn-olive { background: var(--olive); color: white; }
        .btn-video { background: #24A1DE; color: white; margin-top: 15px; width: 100%; }

        /* –†–µ–∂–∏–º –≥–æ—Ç–æ–≤–∫–∏ */
        .instructions { white-space: pre-line; line-height: 1.6; background: white; padding: 25px; border-radius: 20px; margin-top: 20px; }
        .step-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; }
        .step-item.done { opacity: 0.4; text-decoration: line-through; }
        
        .timer-btn { background: #e8eedc; color: var(--olive); padding: 2px 6px; border-radius: 5px; font-weight: bold; cursor: pointer; border-bottom: 2px solid var(--olive); }
        .floating-timer { position: fixed; bottom: 20px; right: 20px; background: var(--olive); color: white; padding: 15px 25px; border-radius: 50px; z-index: 2000; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        .kbju-info { display: flex; gap: 10px; font-size: 0.8rem; margin-top: 10px; color: #666; }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <div @click="page = 'home'" style="cursor:pointer; font-weight: bold; color: var(--olive); font-size: 1.4rem;">üåø ScandiKitchen</div>
            <div class="nav-buttons">
                <button class="btn btn-olive" @click="page = 'planner'">üìÖ –ü–õ–ê–ù</button>
                <button class="btn" style="background:#ddd" @click="page = 'shopping'">üõí –ü–û–ö–£–ü–ö–ò</button>
            </div>
        </header>

        <main class="container">
            <div v-if="page === 'home'">
                <input type="text" v-model="search" placeholder="–ü–æ–∏—Å–∫ (–±–ª—é–¥–æ –∏–ª–∏ –ø—Ä–æ–¥—É–∫—Ç)..." style="margin-bottom:15px;">
                
                <div class="filters-block">
                    <select v-model="selCat">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option v-for="c in categories" :value="c">{{c}}</option>
                    </select>

                    <select v-model="selSub" v-if="subCategories.length > 0">
                        <option value="">–í—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option v-for="s in subCategories" :value="s">{{s}}</option>
                    </select>
                </div>

                <div class="recipe-grid">
                    <div v-for="r in filteredRecipes" class="card" @click="openRecipe(r)">
                        <div style="height:180px; background:#eee; border-radius:15px; overflow:hidden;">
                            <img v-if="r.image" :src="r.image" style="width:100%; height:100%; object-fit:cover;">
                        </div>
                        <h3 style="margin:10px 0 5px 0">{{r.title}}</h3>
                        <div class="kbju-info">
                            <span>üî• {{r.kcal}} –∫–∫–∞–ª</span> <span>ü•© {{r.prot}}–≥ –ë</span>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="page === 'recipe'">
                <button @click="page = 'home'" style="background:none; border:none; color:var(--olive); cursor:pointer; font-weight:bold;">‚Üê –ù–∞–∑–∞–¥</button>
                <h1>{{curR.title}}</h1>

                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:30px;">
                    <div>
                        <div style="width:100%; height:300px; background:#ddd; border-radius:20px; overflow:hidden;">
                            <img :src="curR.image" v-if="curR.image" style="width:100%; height:100%; object-fit:cover;">
                        </div>
                        <a v-if="curR.video" :href="curR.video" target="_blank" class="btn btn-video">üé¨ –°–ú–û–¢–†–ï–¢–¨ –í–ò–î–ï–û-–£–†–û–ö</a>
                        <button class="btn btn-olive" style="width:100%; margin-top:10px;" @click="showDayModal = true">üìÖ –î–û–ë–ê–í–ò–¢–¨ –í –ü–õ–ê–ù</button>
                    </div>

                    <div>
                        <h3>üõí –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã / –ï—Å—Ç—å –¥–æ–º–∞</h3>
                        <div v-for="i in curR.ingredients" style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #eee;">
                            <span>{{i.name}}</span>
                            <div>
                                <b style="margin-right:15px;">{{(i.amount / curR.servings * servings).toFixed(0)}} {{i.unit}}</b>
                                <input type="number" v-model.number="stock[i.name]" placeholder="0" style="width:50px; padding:2px; text-align:center;">
                            </div>
                        </div>
                    </div>
                </div>

                <h3>üë®‚Äçüç≥ –°–ø–æ—Å–æ–± –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</h3>
                <div class="instructions">
                    <div v-for="(step, idx) in curR.steps" 
                         :class="['step-item', doneSteps[curR.id]?.includes(idx) ? 'done' : '']"
                         @click="toggleStep(idx)">
                        <span v-html="formatStep(step)"></span>
                    </div>
                </div>
            </div>
            
            <div v-if="timeLeft > 0" class="floating-timer">
                ‚è± {{ Math.floor(timeLeft / 60) }}:{{ (timeLeft % 60).toString().padStart(2, '0') }}
            </div>
        </main>
    </div>

    <script src="recipes.js"></script>
    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    page: 'home', search: '', selCat: '', selSub: '',
                    categories: ['üçú –°—É–ø—ã','ü•ó –°–∞–ª–∞—Ç—ã','ü•© –û—Å–Ω–æ–≤–Ω—ã–µ (–º—è—Å–æ, –ø—Ç–∏—Ü–∞)','üêü –û—Å–Ω–æ–≤–Ω—ã–µ (—Ä—ã–±–∞)','üçö –ì–∞—Ä–Ω–∏—Ä—ã','ü•ß –í—ã–ø–µ—á–∫–∞','üç∞ –î–µ—Å–µ—Ä—Ç—ã','üçπ –ù–∞–ø–∏—Ç–∫–∏','ü•® –ó–∞–∫—É—Å–∫–∏','üßÇ –°–æ—É—Å—ã'],
                    recipes: typeof myRecipes !== 'undefined' ? myRecipes : [],
                    curR: null, servings: 1, timeLeft: 0,
                    stock: JSON.parse(localStorage.getItem('sk_stock') || '{}'),
                    doneSteps: JSON.parse(localStorage.getItem('sk_steps') || '{}')
                }
            },
            computed: {
                subCategories() {
                    if (!this.selCat) return [];
                    const subs = this.recipes.filter(r => r.category === this.selCat).map(r => r.subcategory);
                    return [...new Set(subs)].filter(s => s);
                },
                filteredRecipes() {
                    return this.recipes.filter(r => {
                        const mSearch = r.title.toLowerCase().includes(this.search.toLowerCase()) || r.ingredients.some(i => i.name.toLowerCase().includes(this.search.toLowerCase()));
                        const mCat = !this.selCat || r.category === this.selCat;
                        const mSub = !this.selSub || r.subcategory === this.selSub;
                        return mSearch && mCat && mSub;
                    });
                }
            },
            methods: {
                openRecipe(r) { this.curR = r; this.servings = r.servings; this.page = 'recipe'; window.scrollTo(0,0); },
                formatStep(text) {
                    return text.replace(/(\d+)\s*(–º–∏–Ω—É—Ç|–º–∏–Ω)/g, (m, val) => `<span class="timer-btn" onclick="event.stopPropagation(); window.startT(${val})">${m}</span>`);
                },
                toggleStep(idx) {
                    if(!this.doneSteps[this.curR.id]) this.doneSteps[this.curR.id] = [];
                    const arr = this.doneSteps[this.curR.id];
                    arr.includes(idx) ? arr.splice(arr.indexOf(idx), 1) : arr.push(idx);
                    localStorage.setItem('sk_steps', JSON.stringify(this.doneSteps));
                }
            },
            mounted() {
                window.startT = (m) => {
                    this.timeLeft = m * 60;
                    if(this.timer) clearInterval(this.timer);
                    this.timer = setInterval(() => {
                        this.timeLeft--;
                        if(this.timeLeft <= 0) { clearInterval(this.timer); alert('–í—Ä–µ–º—è –≤—ã—à–ª–æ!'); }
                    }, 1000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
